name: 'CD pong for ZIG dependencies'
description: 'Update the build.zig.zon before making a PR'
inputs:
  url:
    description: 'The zig URL repository'
    required: true
  tag:
    description: 'The pushed tag of the used dependency'
    required: true
  hash:
    description: 'The zig hash of the pushed tag of the used dependency'
    required: true
runs:
  using: "composite"
  steps:
    - name: Setup Zig
      uses: goto-bus-stop/setup-zig@v2.2.0
      with:
        version: ${{ env.zig_version }}

    - name: Update the build.zig.zon
      shell: ${{ env.shell }}
      run: |
        zon_url="$(grep -o "${{ inputs.url }}/.*\.tar\.gz" build.zig.zon)"
        zon_hash="$(zig fetch "${zon_url}")"
        sed -i "s@${zon_url}@${{ inputs.url }}/refs/tags/${{ inputs.tag }}.tar.gz@;
                s@${zon_hash}@${{ inputs.hash }}@" build.zig.zon
